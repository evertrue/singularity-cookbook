#!/usr/bin/env bash

if [ -n "$EXECUTOR_DEBUG" ]; then
  set -x

  echo "Running the Singularity Executor with args: ${@}"
  echo "Exports:"

  export

  echo
  echo "Set:"
  set
fi

<%= node['java']['java_home'] %>/bin/java \
  <% node['singularity']['executor']['extra_args'].each do |arg| -%>
  <%= arg %> \
  <%- end %>
  -Djava.library.path=/usr/local/lib \
  -jar <%= node['singularity']['home'] %>/bin/SingularityExecutor
